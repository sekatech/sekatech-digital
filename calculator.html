<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StechDigitall - Professional Tile Calculator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --border-radius: 8px;
            --transition: all 0.3s ease;
        }

        body {
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1.5rem 0;
            box-shadow: var(--shadow);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo i {
            font-size: 2.5rem;
            color: var(--accent-color);
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .logo span {
            color: var(--accent-color);
        }

        .brand-tagline {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-top: 5px;
        }

        /* Main Layout */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 30px 0;
        }

        @media (max-width: 992px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* Calculator Panel */
        .calculator-panel {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--shadow);
        }

        .panel-title {
            color: var(--primary-color);
            border-bottom: 2px solid var(--light-color);
            padding-bottom: 15px;
            margin-bottom: 25px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .panel-title i {
            color: var(--secondary-color);
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 25px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-color);
        }

        .form-input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-input:focus {
            border-color: var(--secondary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .input-with-unit {
            position: relative;
        }

        .unit {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #777;
        }

        .form-select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            background-color: white;
            cursor: pointer;
        }

        /* Surface Area Inputs */
        .surface-areas {
            margin-top: 20px;
        }

        .area-item {
            background-color: #f9f9f9;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid var(--secondary-color);
        }

        .area-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .area-title {
            font-weight: 600;
            color: var(--primary-color);
        }

        .remove-area {
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .remove-area:hover {
            background: #c0392b;
        }

        .add-area-btn {
            background-color: var(--success-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            padding: 12px 20px;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            transition: var(--transition);
            width: 100%;
            justify-content: center;
        }

        .add-area-btn:hover {
            background-color: #219653;
        }

        /* Calculation Results */
        .results-panel {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--shadow);
        }

        .results-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .result-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: var(--border-radius);
            padding: 20px;
            text-align: center;
            border-top: 4px solid var(--secondary-color);
        }

        .result-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin: 10px 0;
        }

        .result-label {
            font-size: 0.9rem;
            color: #666;
        }

        .result-unit {
            font-size: 0.9rem;
            color: var(--secondary-color);
            font-weight: 600;
        }

        .breakdown-section {
            margin-top: 30px;
        }

        .breakdown-item {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }

        .breakdown-item:last-child {
            border-bottom: none;
            font-weight: 700;
            color: var(--primary-color);
            font-size: 1.1rem;
        }

        /* Tile Visualization */
        .visualization-section {
            margin-top: 30px;
        }

        .tile-visualization {
            height: 200px;
            background-color: #f5f7fa;
            border-radius: var(--border-radius);
            position: relative;
            overflow: hidden;
            border: 1px solid #ddd;
            margin-top: 15px;
        }

        .tile-grid {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: grid;
            pointer-events: none;
        }

        .tile-cell {
            border: 1px solid rgba(52, 152, 219, 0.2);
            background-color: rgba(255, 255, 255, 0.7);
        }

        .cut-tile {
            background-color: rgba(231, 76, 60, 0.2);
        }

        /* Buttons */
        .btn-primary {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            justify-content: center;
            margin-top: 20px;
        }

        .btn-primary:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: #f8f9fa;
            color: var(--primary-color);
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            padding: 10px 20px;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-secondary:hover {
            background-color: #e9ecef;
        }

        /* Footer */
        footer {
            background-color: var(--primary-color);
            color: white;
            padding: 40px 0 20px;
            margin-top: 50px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .footer-section h3 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: var(--accent-color);
        }

        .footer-section p {
            opacity: 0.8;
            margin-bottom: 15px;
        }

        .copyright {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            opacity: 0.7;
            font-size: 0.9rem;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .calculator-panel, .results-panel {
                padding: 20px;
            }
            
            .panel-title {
                font-size: 1.3rem;
            }
            
            .result-value {
                font-size: 1.5rem;
            }
        }

        /* Print styles */
        @media print {
            .no-print {
                display: none;
            }
            
            .calculator-panel, .results-panel {
                box-shadow: none;
                border: 1px solid #ddd;
            }
            
            .btn-primary, .add-area-btn, .remove-area {
                display: none;
            }
        }

        /* Loading animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Additional styling for better UI */
        .calculation-note {
            background-color: #fff8e1;
            border-left: 4px solid var(--warning-color);
            padding: 15px;
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
            margin-top: 20px;
            font-size: 0.9rem;
        }

        .tile-icon {
            color: var(--secondary-color);
            font-size: 1.2rem;
            margin-right: 5px;
        }

        .required::after {
            content: " *";
            color: var(--accent-color);
        }

        .error-message {
            color: var(--accent-color);
            font-size: 0.85rem;
            margin-top: 5px;
            display: none;
        }

        .has-error .form-input {
            border-color: var(--accent-color);
        }

        .has-error .error-message {
            display: block;
        }

        .waste-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .waste-option {
            flex: 1;
            min-width: 120px;
        }

        .waste-option input[type="radio"] {
            display: none;
        }

        .waste-option label {
            display: block;
            padding: 10px 15px;
            background-color: #f1f1f1;
            border-radius: var(--border-radius);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .waste-option input[type="radio"]:checked + label {
            background-color: var(--secondary-color);
            color: white;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-cube"></i>
                    <div>
                        <h1>StechDigitall <span>Tile Calculator</span></h1>
                        <p class="brand-tagline">Professional tile estimation tool for precise project planning</p>
                    </div>
                </div>
                <div class="no-print">
                    <button class="btn-secondary" id="printBtn">
                        <i class="fas fa-print"></i> Print Estimate
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="main-content">
            <!-- Calculator Panel -->
            <div class="calculator-panel">
                <h2 class="panel-title">
                    <i class="fas fa-calculator"></i> Tile Specifications
                </h2>
                
                <form id="tileCalculatorForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required">Tile Length (cm)</label>
                            <div class="input-with-unit">
                                <input type="number" id="tileLength" class="form-input" min="1" max="500" value="30" step="0.1" required>
                                <span class="unit">cm</span>
                            </div>
                            <div class="error-message" id="lengthError">Please enter a valid length between 1 and 500 cm</div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label required">Tile Width (cm)</label>
                            <div class="input-with-unit">
                                <input type="number" id="tileWidth" class="form-input" min="1" max="500" value="30" step="0.1" required>
                                <span class="unit">cm</span>
                            </div>
                            <div class="error-message" id="widthError">Please enter a valid width between 1 and 500 cm</div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required">Tiles per Carton</label>
                            <div class="input-with-unit">
                                <input type="number" id="tilesPerCarton" class="form-input" min="1" max="1000" value="10" required>
                                <span class="unit">tiles</span>
                            </div>
                            <div class="error-message" id="cartonError">Please enter a valid number between 1 and 1000</div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label required">Carton Price (₦)</label>
                            <div class="input-with-unit">
                                <input type="number" id="cartonPrice" class="form-input" min="0" max="1000000" value="15000" step="100" required>
                                <span class="unit">₦</span>
                            </div>
                            <div class="error-message" id="priceError">Please enter a valid price</div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Waste Factor</label>
                        <div class="waste-options">
                            <div class="waste-option">
                                <input type="radio" id="waste5" name="waste" value="5" checked>
                                <label for="waste5">Low (5%)</label>
                            </div>
                            <div class="waste-option">
                                <input type="radio" id="waste10" name="waste" value="10">
                                <label for="waste10">Standard (10%)</label>
                            </div>
                            <div class="waste-option">
                                <input type="radio" id="waste15" name="waste" value="15">
                                <label for="waste15">High (15%)</label>
                            </div>
                            <div class="waste-option">
                                <input type="radio" id="waste20" name="waste" value="20">
                                <label for="waste20">Complex (20%)</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Grout Width (mm)</label>
                        <div class="input-with-unit">
                            <input type="number" id="groutWidth" class="form-input" min="0" max="50" value="3" step="0.5">
                            <span class="unit">mm</span>
                        </div>
                    </div>
                    
                    <h2 class="panel-title" style="margin-top: 40px;">
                        <i class="fas fa-ruler-combined"></i> Surface Areas
                    </h2>
                    
                    <div class="surface-areas" id="surfaceAreas">
                        <!-- Area items will be added dynamically -->
                        <div class="area-item">
                            <div class="area-header">
                                <div class="area-title">Area #1</div>
                                <button type="button" class="remove-area" disabled>
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label required">Length (m)</label>
                                    <div class="input-with-unit">
                                        <input type="number" class="form-input area-length" min="0.1" max="1000" value="5" step="0.01" required>
                                        <span class="unit">m</span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label required">Width (m)</label>
                                    <div class="input-with-unit">
                                        <input type="number" class="form-input area-width" min="0.1" max="1000" value="4" step="0.01" required>
                                        <span class="unit">m</span>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Area Name (Optional)</label>
                                <input type="text" class="form-input area-name" placeholder="e.g., Living Room">
                            </div>
                        </div>
                    </div>
                    
                    <button type="button" class="add-area-btn" id="addAreaBtn">
                        <i class="fas fa-plus-circle"></i> Add Another Area
                    </button>
                    
                    <button type="submit" class="btn-primary" id="calculateBtn">
                        <i class="fas fa-calculator"></i> Calculate Tile Requirements
                    </button>
                </form>
                
                <div class="calculation-note">
                    <p><i class="fas fa-info-circle tile-icon"></i> <strong>Note:</strong> The calculator accounts for tile layout, cutting waste, and grout spacing. Results are estimates; always purchase 5-10% extra tiles for replacements.</p>
                </div>
            </div>
            
            <!-- Results Panel -->
            <div class="results-panel">
                <h2 class="panel-title">
                    <i class="fas fa-chart-bar"></i> Calculation Results
                </h2>
                
                <div id="resultsPlaceholder">
                    <div style="text-align: center; padding: 60px 20px; color: #777;">
                        <i class="fas fa-calculator" style="font-size: 3rem; margin-bottom: 20px; color: #ddd;"></i>
                        <h3>Your Results Will Appear Here</h3>
                        <p>Fill in the tile specifications and surface areas, then click "Calculate Tile Requirements" to see detailed results.</p>
                    </div>
                </div>
                
                <div id="resultsContent" style="display: none;">
                    <div class="results-summary">
                        <div class="result-card">
                            <div class="result-label">Total Area</div>
                            <div class="result-value" id="totalArea">0</div>
                            <div class="result-unit">m²</div>
                        </div>
                        <div class="result-card">
                            <div class="result-label">Tiles Needed</div>
                            <div class="result-value" id="totalTiles">0</div>
                            <div class="result-unit">tiles</div>
                        </div>
                        <div class="result-card">
                            <div class="result-label">Cartons Needed</div>
                            <div class="result-value" id="totalCartons">0</div>
                            <div class="result-unit">cartons</div>
                        </div>
                        <div class="result-card">
                            <div class="result-label">Total Cost</div>
                            <div class="result-value" id="totalCost">0</div>
                            <div class="result-unit">₦</div>
                        </div>
                    </div>
                    
                    <div class="breakdown-section">
                        <h3 style="color: var(--primary-color); margin-bottom: 20px;">Cost Breakdown</h3>
                        <div class="breakdown-item">
                            <span>Tile Cost</span>
                            <span id="tileCost">₦ 0</span>
                        </div>
                        <div class="breakdown-item">
                            <span>Waste Factor (<span id="wastePercent">0</span>%)</span>
                            <span id="wasteCost">₦ 0</span>
                        </div>
                        <div class="breakdown-item">
                            <span>Total Estimated Cost</span>
                            <span id="estimatedCost">₦ 0</span>
                        </div>
                    </div>
                    
                    <div class="visualization-section">
                        <h3 style="color: var(--primary-color); margin-bottom: 20px;">Tile Layout Visualization</h3>
                        <p style="margin-bottom: 10px; color: #666;">Visual representation of tile placement (approximate scale)</p>
                        <div class="tile-visualization" id="tileVisualization">
                            <div class="tile-grid" id="tileGrid"></div>
                        </div>
                        <div style="display: flex; gap: 20px; margin-top: 15px; font-size: 0.9rem;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div style="width: 20px; height: 20px; background-color: rgba(255, 255, 255, 0.7); border: 1px solid rgba(52, 152, 219, 0.2);"></div>
                                <span>Full Tile</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div style="width: 20px; height: 20px; background-color: rgba(231, 76, 60, 0.2); border: 1px solid rgba(231, 76, 60, 0.5);"></div>
                                <span>Cut Tile</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="calculation-note" style="margin-top: 30px;">
                        <p><i class="fas fa-lightbulb tile-icon"></i> <strong>Recommendation:</strong> Purchase <span id="recommendedCartons">0</span> cartons to account for breakages and future repairs. This includes the recommended <span id="recommendedExtra">0</span>% extra tiles.</p>
                    </div>
                    
                    <div class="no-print" style="margin-top: 30px;">
                        <button class="btn-secondary" id="exportBtn">
                            <i class="fas fa-file-export"></i> Export as PDF
                        </button>
                        <button class="btn-secondary" id="resetBtn" style="float: right;">
                            <i class="fas fa-redo"></i> Reset Calculator
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>About StechDigitall</h3>
                    <p>StechDigitall provides professional construction estimation tools for architects, contractors, and DIY enthusiasts.</p>
                    <p>Our tile calculator helps you accurately estimate materials and costs for any tiling project.</p>
                </div>
                <div class="footer-section">
                    <h3>Calculation Methodology</h3>
                    <p>Our calculator accounts for:</p>
                    <p>• Tile dimensions and layout</p>
                    <p>• Cutting waste and breakage</p>
                    <p>• Grout spacing</p>
                    <p>• Carton packaging</p>
                </div>
                <div class="footer-section">
                    <h3>Contact & Support</h3>
                    <p>For technical support or custom solutions:</p>
                    <p><i class="fas fa-envelope"></i> support@stechdigitall.ink</p>
                    <p><i class="fas fa-phone"></i> +234 800 123 4567</p>
                    <p><i class="fas fa-globe"></i> www.stechdigitall.ink</p>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2023 StechDigitall.ink | Professional Tile Calculator v2.1 | All calculations are estimates</p>
            </div>
        </div>
    </footer>

    <script>
        // DOM Elements
        const tileCalculatorForm = document.getElementById('tileCalculatorForm');
        const surfaceAreasContainer = document.getElementById('surfaceAreas');
        const addAreaBtn = document.getElementById('addAreaBtn');
        const calculateBtn = document.getElementById('calculateBtn');
        const printBtn = document.getElementById('printBtn');
        const exportBtn = document.getElementById('exportBtn');
        const resetBtn = document.getElementById('resetBtn');
        const resultsPlaceholder = document.getElementById('resultsPlaceholder');
        const resultsContent = document.getElementById('resultsContent');
        
        // Results elements
        const totalAreaEl = document.getElementById('totalArea');
        const totalTilesEl = document.getElementById('totalTiles');
        const totalCartonsEl = document.getElementById('totalCartons');
        const totalCostEl = document.getElementById('totalCost');
        const tileCostEl = document.getElementById('tileCost');
        const wastePercentEl = document.getElementById('wastePercent');
        const wasteCostEl = document.getElementById('wasteCost');
        const estimatedCostEl = document.getElementById('estimatedCost');
        const recommendedCartonsEl = document.getElementById('recommendedCartons');
        const recommendedExtraEl = document.getElementById('recommendedExtra');
        const tileGrid = document.getElementById('tileGrid');
        
        // Tile Calculation Variables
        let areaCounter = 1;
        let calculationResults = null;
        
        // Initialize the app
        function initApp() {
            // Add event listeners
            addAreaBtn.addEventListener('click', addNewArea);
            tileCalculatorForm.addEventListener('submit', handleFormSubmit);
            printBtn.addEventListener('click', handlePrint);
            exportBtn.addEventListener('click', handleExport);
            resetBtn.addEventListener('click', handleReset);
            
            // Add input validation
            setupInputValidation();
            
            // Perform initial calculation
            performCalculation();
        }
        
        // Setup input validation
        function setupInputValidation() {
            const inputs = document.querySelectorAll('.form-input[required]');
            inputs.forEach(input => {
                input.addEventListener('blur', validateInput);
                input.addEventListener('input', clearError);
            });
        }
        
        // Validate individual input
        function validateInput(e) {
            const input = e.target;
            const value = parseFloat(input.value);
            const parent = input.closest('.form-group');
            let error = false;
            let errorMessage = '';
            
            // Check if empty
            if (!input.value.trim()) {
                error = true;
                errorMessage = 'This field is required';
            }
            // Check if valid number
            else if (isNaN(value) || value <= 0) {
                error = true;
                errorMessage = 'Please enter a valid positive number';
            }
            // Check specific range constraints
            else {
                if (input.id === 'tileLength' || input.id === 'tileWidth') {
                    if (value < 1 || value > 500) {
                        error = true;
                        errorMessage = 'Please enter a value between 1 and 500 cm';
                    }
                } else if (input.id === 'tilesPerCarton') {
                    if (value < 1 || value > 1000) {
                        error = true;
                        errorMessage = 'Please enter a value between 1 and 1000';
                    }
                } else if (input.id === 'cartonPrice') {
                    if (value < 0 || value > 1000000) {
                        error = true;
                        errorMessage = 'Please enter a value between 0 and 1,000,000';
                    }
                } else if (input.classList.contains('area-length') || input.classList.contains('area-width')) {
                    if (value < 0.1 || value > 1000) {
                        error = true;
                        errorMessage = 'Please enter a value between 0.1 and 1000 m';
                    }
                }
            }
            
            // Update UI based on validation
            if (error) {
                parent.classList.add('has-error');
                const errorEl = parent.querySelector('.error-message');
                if (errorEl) errorEl.textContent = errorMessage;
            } else {
                parent.classList.remove('has-error');
            }
            
            return !error;
        }
        
        // Clear error state
        function clearError(e) {
            const input = e.target;
            const parent = input.closest('.form-group');
            parent.classList.remove('has-error');
        }
        
        // Validate entire form
        function validateForm() {
            let isValid = true;
            const requiredInputs = document.querySelectorAll('.form-input[required]');
            
            requiredInputs.forEach(input => {
                // Create a blur event to trigger validation
                const event = new Event('blur');
                input.dispatchEvent(event);
                
                // Check if the input now has error
                if (input.closest('.form-group').classList.contains('has-error')) {
                    isValid = false;
                }
            });
            
            return isValid;
        }
        
        // Add new area input
        function addNewArea() {
            areaCounter++;
            const areaHTML = `
                <div class="area-item">
                    <div class="area-header">
                        <div class="area-title">Area #${areaCounter}</div>
                        <button type="button" class="remove-area">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required">Length (m)</label>
                            <div class="input-with-unit">
                                <input type="number" class="form-input area-length" min="0.1" max="1000" value="3" step="0.01" required>
                                <span class="unit">m</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label required">Width (m)</label>
                            <div class="input-with-unit">
                                <input type="number" class="form-input area-width" min="0.1" max="1000" value="3" step="0.01" required>
                                <span class="unit">m</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Area Name (Optional)</label>
                        <input type="text" class="form-input area-name" placeholder="e.g., Kitchen">
                    </div>
                </div>
            `;
            
            surfaceAreasContainer.insertAdjacentHTML('beforeend', areaHTML);
            
            // Add event listeners to the new inputs
            const newArea = surfaceAreasContainer.lastElementChild;
            const newInputs = newArea.querySelectorAll('.form-input[required]');
            newInputs.forEach(input => {
                input.addEventListener('blur', validateInput);
                input.addEventListener('input', clearError);
            });
            
            // Add event listener to remove button
            const removeBtn = newArea.querySelector('.remove-area');
            removeBtn.addEventListener('click', function() {
                this.closest('.area-item').remove();
                updateAreaNumbers();
            });
            
            // Enable remove buttons if there's more than one area
            updateRemoveButtons();
        }
        
        // Update area numbers after removal
        function updateAreaNumbers() {
            const areaItems = document.querySelectorAll('.area-item');
            areaCounter = areaItems.length;
            
            areaItems.forEach((item, index) => {
                const title = item.querySelector('.area-title');
                title.textContent = `Area #${index + 1}`;
            });
            
            updateRemoveButtons();
        }
        
        // Enable/disable remove buttons based on area count
        function updateRemoveButtons() {
            const removeButtons = document.querySelectorAll('.remove-area');
            if (removeButtons.length <= 1) {
                removeButtons.forEach(btn => btn.disabled = true);
            } else {
                removeButtons.forEach(btn => btn.disabled = false);
            }
        }
        
        // Handle form submission
        function handleFormSubmit(e) {
            e.preventDefault();
            
            // Validate form
            if (!validateForm()) {
                alert('Please fix the errors in the form before calculating.');
                return;
            }
            
            // Perform calculation
            performCalculation();
        }
        
        // Perform tile calculation
        function performCalculation() {
            // Get tile specifications
            const tileLength = parseFloat(document.getElementById('tileLength').value) / 100; // Convert to meters
            const tileWidth = parseFloat(document.getElementById('tileWidth').value) / 100; // Convert to meters
            const tilesPerCarton = parseInt(document.getElementById('tilesPerCarton').value);
            const cartonPrice = parseFloat(document.getElementById('cartonPrice').value);
            
            // Get waste factor
            const wasteFactor = parseFloat(document.querySelector('input[name="waste"]:checked').value) / 100;
            
            // Get grout width (convert mm to meters)
            const groutWidth = parseFloat(document.getElementById('groutWidth').value) / 1000;
            
            // Calculate total surface area
            let totalArea = 0;
            const areaItems = document.querySelectorAll('.area-item');
            const areaDetails = [];
            
            areaItems.forEach((item, index) => {
                const length = parseFloat(item.querySelector('.area-length').value);
                const width = parseFloat(item.querySelector('.area-width').value);
                const name = item.querySelector('.area-name').value || `Area #${index + 1}`;
                
                const area = length * width;
                totalArea += area;
                
                areaDetails.push({
                    name,
                    length,
                    width,
                    area
                });
            });
            
            // Calculate tile area with grout spacing
            const tileAreaWithGrout = (tileLength + groutWidth) * (tileWidth + groutWidth);
            
            // Calculate number of tiles needed (without waste)
            let tilesNeededWithoutWaste = totalArea / tileAreaWithGrout;
            
            // Apply waste factor
            let tilesNeededWithWaste = tilesNeededWithoutWaste * (1 + wasteFactor);
            
            // Round up to nearest whole tile
            tilesNeededWithWaste = Math.ceil(tilesNeededWithWaste);
            
            // Calculate number of cartons needed
            let cartonsNeeded = Math.ceil(tilesNeededWithWaste / tilesPerCarton);
            
            // Calculate costs
            const tileCost = cartonsNeeded * cartonPrice;
            const wasteTiles = tilesNeededWithWaste - tilesNeededWithoutWaste;
            const wasteCost = Math.ceil(wasteTiles / tilesPerCarton) * cartonPrice;
            const totalCost = tileCost;
            
            // Calculate recommended extra (10% more for breakages and future repairs)
            const recommendedExtra = 0.1;
            const recommendedCartons = Math.ceil(cartonsNeeded * (1 + recommendedExtra));
            
            // Store calculation results
            calculationResults = {
                tileLength: tileLength * 100, // Back to cm
                tileWidth: tileWidth * 100, // Back to cm
                tileArea: tileLength * tileWidth,
                tileAreaWithGrout,
                tilesPerCarton,
                cartonPrice,
                wasteFactor: wasteFactor * 100,
                groutWidth: groutWidth * 1000, // Back to mm
                totalArea,
                areaDetails,
                tilesNeededWithoutWaste,
                tilesNeededWithWaste,
                cartonsNeeded,
                tileCost,
                wasteTiles,
                wasteCost,
                totalCost,
                recommendedExtra: recommendedExtra * 100,
                recommendedCartons
            };
            
            // Update UI with results
            updateResultsUI();
            
            // Generate tile visualization
            generateTileVisualization();
        }
        
        // Update results UI
        function updateResultsUI() {
            if (!calculationResults) return;
            
            // Show results content, hide placeholder
            resultsPlaceholder.style.display = 'none';
            resultsContent.style.display = 'block';
            
            // Format numbers
            const formatNumber = (num, decimals = 2) => {
                return num.toLocaleString(undefined, {
                    minimumFractionDigits: decimals,
                    maximumFractionDigits: decimals
                });
            };
            
            const formatCurrency = (num) => {
                return `₦ ${num.toLocaleString(undefined, {
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                })}`;
            };
            
            // Update results
            totalAreaEl.textContent = formatNumber(calculationResults.totalArea);
            totalTilesEl.textContent = formatNumber(calculationResults.tilesNeededWithWaste, 0);
            totalCartonsEl.textContent = formatNumber(calculationResults.cartonsNeeded, 0);
            totalCostEl.textContent = formatCurrency(calculationResults.totalCost);
            
            tileCostEl.textContent = formatCurrency(calculationResults.tileCost);
            wastePercentEl.textContent = formatNumber(calculationResults.wasteFactor, 0);
            wasteCostEl.textContent = formatCurrency(calculationResults.wasteCost);
            estimatedCostEl.textContent = formatCurrency(calculationResults.totalCost);
            
            recommendedCartonsEl.textContent = calculationResults.recommendedCartons;
            recommendedExtraEl.textContent = calculationResults.recommendedExtra;
        }
        
        // Generate tile visualization
        function generateTileVisualization() {
            if (!calculationResults) return;
            
            // Clear previous grid
            tileGrid.innerHTML = '';
            
            // Get tile dimensions in cm
            const tileLength = calculationResults.tileLength; // cm
            const tileWidth = calculationResults.tileWidth; // cm
            
            // Get the largest area for visualization
            let largestArea = { length: 0, width: 0 };
            if (calculationResults.areaDetails.length > 0) {
                // Find the area with the largest dimension for visualization
                calculationResults.areaDetails.forEach(area => {
                    if (area.length > largestArea.length) {
                        largestArea.length = area.length;
                        largestArea.width = area.width;
                    }
                });
            } else {
                // Default to first area if no areas defined
                largestArea.length = 5;
                largestArea.width = 4;
            }
            
            // Convert area dimensions to cm
            const areaLength = largestArea.length * 100; // cm
            const areaWidth = largestArea.width * 100; // cm
            
            // Calculate how many tiles fit in each dimension
            const tilesInLength = Math.ceil(areaLength / tileLength);
            const tilesInWidth = Math.ceil(areaWidth / tileWidth);
            
            // Set grid dimensions
            const gridColumns = Math.min(tilesInLength, 20); // Limit for visualization
            const gridRows = Math.min(tilesInWidth, 15); // Limit for visualization
            
            // Calculate tile size in visualization (scaled down)
            const containerWidth = tileGrid.parentElement.clientWidth;
            const containerHeight = tileGrid.parentElement.clientHeight;
            
            const tileVizWidth = Math.min(containerWidth / gridColumns, 40);
            const tileVizHeight = Math.min(containerHeight / gridRows, 40);
            
            // Set grid style
            tileGrid.style.gridTemplateColumns = `repeat(${gridColumns}, ${tileVizWidth}px)`;
            tileGrid.style.gridTemplateRows = `repeat(${gridRows}, ${tileVizHeight}px)`;
            
            // Create tile cells
            for (let row = 0; row < gridRows; row++) {
                for (let col = 0; col < gridColumns; col++) {
                    const tileCell = document.createElement('div');
                    tileCell.className = 'tile-cell';
                    
                    // Determine if this tile would be cut (last row or column)
                    if (row === gridRows - 1 || col === gridColumns - 1) {
                        tileCell.classList.add('cut-tile');
                    }
                    
                    // Add tile number for debugging
                    // tileCell.textContent = `${row+1}-${col+1}`;
                    // tileCell.style.display = 'flex';
                    // tileCell.style.alignItems = 'center';
                    // tileCell.style.justifyContent = 'center';
                    // tileCell.style.fontSize = '8px';
                    
                    tileGrid.appendChild(tileCell);
                }
            }
        }
        
        // Handle print
        function handlePrint() {
            window.print();
        }
        
        // Handle export (simulated for this example)
        function handleExport() {
            alert('PDF export functionality would be implemented in a production environment. For now, please use the print function to save as PDF.');
            // In a real application, you would use a library like jsPDF or html2pdf.js
        }
        
        // Handle reset
        function handleReset() {
            if (confirm('Are you sure you want to reset the calculator? All entered data will be lost.')) {
                // Reset form
                tileCalculatorForm.reset();
                
                // Reset area counter and remove all but first area
                areaCounter = 1;
                const areaItems = document.querySelectorAll('.area-item');
                areaItems.forEach((item, index) => {
                    if (index > 0) {
                        item.remove();
                    } else {
                        // Reset first area to default values
                        item.querySelector('.area-length').value = 5;
                        item.querySelector('.area-width').value = 4;
                        item.querySelector('.area-name').value = '';
                    }
                });
                
                // Update area numbers
                updateAreaNumbers();
                
                // Clear errors
                document.querySelectorAll('.has-error').forEach(el => {
                    el.classList.remove('has-error');
                });
                
                // Reset results display
                resultsPlaceholder.style.display = 'block';
                resultsContent.style.display = 'none';
                
                // Clear calculation results
                calculationResults = null;
                
                // Perform initial calculation
                performCalculation();
            }
        }
        
        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
        
        // Update visualization on window resize
        window.addEventListener('resize', function() {
            if (calculationResults) {
                generateTileVisualization();
            }
        });
        
        // Add event listeners to initial remove button (disabled)
        document.querySelector('.remove-area').addEventListener('click', function() {
            if (!this.disabled) {
                this.closest('.area-item').remove();
                updateAreaNumbers();
            }
        });
        
        // Perform calculation when any input changes
        const autoCalculateInputs = document.querySelectorAll('#tileCalculatorForm input, #tileCalculatorForm select');
        autoCalculateInputs.forEach(input => {
            input.addEventListener('change', function() {
                if (tileCalculatorForm.checkValidity()) {
                    performCalculation();
                }
            });
        });
    </script>
</body>
</html>